<!doctype html><html lang=ja dir=ltr><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.112.3"><meta name=generator content="Relearn 5.12.5+tip"><meta name=description content="ものづくりコンテストについての情報をまとめたWikiです"><meta name=author content="KATO Jinnosuke"><title>サンプルコード集 :: ものコン-wiki</title><link href=https://jinnosukekato.github.io/monokon-wiki/software/sample-code-collection/index.html rel=canonical type=text/html title="サンプルコード集 :: ものコン-wiki"><link href=https://jinnosukekato.github.io/monokon-wiki/css/fontawesome-all.min.css?1684985525 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=https://jinnosukekato.github.io/monokon-wiki/css/fontawesome-all.min.css?1684985525 rel=stylesheet></noscript><link href=https://jinnosukekato.github.io/monokon-wiki/css/nucleus.css?1684985525 rel=stylesheet><link href=https://jinnosukekato.github.io/monokon-wiki/css/auto-complete.css?1684985525 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=https://jinnosukekato.github.io/monokon-wiki/css/auto-complete.css?1684985525 rel=stylesheet></noscript><link href=https://jinnosukekato.github.io/monokon-wiki/css/perfect-scrollbar.min.css?1684985525 rel=stylesheet><link href=https://jinnosukekato.github.io/monokon-wiki/css/fonts.css?1684985525 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=https://jinnosukekato.github.io/monokon-wiki/css/fonts.css?1684985525 rel=stylesheet></noscript><link href=https://jinnosukekato.github.io/monokon-wiki/css/theme.css?1684985525 rel=stylesheet><link href=https://jinnosukekato.github.io/monokon-wiki/css/theme-relearn-light.css?1684985525 rel=stylesheet id=variant-style><link href=https://jinnosukekato.github.io/monokon-wiki/css/variant.css?1684985525 rel=stylesheet><link href=https://jinnosukekato.github.io/monokon-wiki/css/print.css?1684985525 rel=stylesheet media=print><link href=https://jinnosukekato.github.io/monokon-wiki/css/format-print.css?1684985525 rel=stylesheet><link href=https://jinnosukekato.github.io/monokon-wiki/css/ie.css?1684985525 rel=stylesheet><script src=https://jinnosukekato.github.io/monokon-wiki/js/url.js?1684985525></script>
<script src=https://jinnosukekato.github.io/monokon-wiki/js/variant.js?1684985525></script>
<script>window.index_js_url="https://jinnosukekato.github.io/monokon-wiki/index.search.js";var root_url="https://jinnosukekato.github.io/monokon-wiki/",baseUriFull,baseUri=root_url.replace(/\/$/,"");window.T_Copy_to_clipboard="クリップボードにコピー",window.T_Copied_to_clipboard="クリップボードにコピー!",window.T_Copy_link_to_clipboard="リンクをクリップボードにコピー",window.T_Link_copied_to_clipboard="リンクをクリップボードにコピーしました!",window.T_No_results_found="\u0022{0}\u0022 の結果が見つかりません",window.T_N_results_found="\u0022{0}\u0022 で {1} 件の結果が見つかりました",baseUriFull="https://jinnosukekato.github.io/monokon-wiki/",window.variants&&variants.init(["relearn-light","relearn-dark"])</script></head><body class="mobile-support print" data-url=https://jinnosukekato.github.io/monokon-wiki/software/sample-code-collection/index.html><div id=body class=default-animation><div id=sidebar-overlay></div><div id=toc-overlay></div><nav id=topbar class=highlightable><div><div id=breadcrumbs><span id=sidebar-toggle-span><a href=# id=sidebar-toggle class=topbar-link title='メニュー (CTRL+ALT+n)'><i class="fas fa-bars fa-fw"></i></a></span><ol class=links itemscope itemtype=http://schema.org/BreadcrumbList><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=https://jinnosukekato.github.io/monokon-wiki/index.html><span itemprop=name>ものコン wiki</span></a><meta itemprop=position content="1">></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=https://jinnosukekato.github.io/monokon-wiki/software/index.html><span itemprop=name>ソフトウェア</span></a><meta itemprop=position content="2">></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><span itemprop=name>サンプルコード集</span><meta itemprop=position content="3"></li></ol></div></div></nav><main id=body-inner class="highlightable default" tabindex=-1><div class=flex-block-wrapper><div id=head-tags><div class=tags><a class=tag-link href=https://jinnosukekato.github.io/monokon-wiki/tags/%E8%B3%87%E6%96%99/index.html>資料</a></div></div><article class=default><h1 id=サンプルコード集>サンプルコード集</h1><p>作る機会の多い関数のサンプルを集めました</p><p>参考にしてもらって構いませんが、<strong>まずは自分で考えることが大事です</strong></p><p>また、このサンプルのピンは Arduino MEGA を前提としているので、 UNO(小さいほう)を使うときは逐次書き換えてください</p><h2 id=クロック>クロック</h2><p><a href=https://jinnosukekato.github.io/monokon-wiki/hardware/about-parts/output-parts/stepper>ステッピングモーター</a>、
<a href=https://jinnosukekato.github.io/monokon-wiki/hardware/about-parts/output-parts/dc-motor>DCモーター</a>を回転させるときに使うクロックです</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++><span style=display:flex><span><span style=color:#66d9ef>void</span> <span style=color:#a6e22e>clock</span>() {
</span></span><span style=display:flex><span>    digitalWrite(<span style=color:#ae81ff>5</span>, <span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>    delay(<span style=color:#ae81ff>5</span>);
</span></span><span style=display:flex><span>    digitalWrite(<span style=color:#ae81ff>5</span>, <span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><a href=https://jinnosukekato.github.io/monokon-wiki/software/embedded-functions/delay>delay</a> の秒数を指定できるバージョン</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++><span style=display:flex><span><span style=color:#66d9ef>void</span> <span style=color:#a6e22e>clock</span>(<span style=color:#66d9ef>int</span> ms) {
</span></span><span style=display:flex><span>    digitalWrite(<span style=color:#ae81ff>5</span>, <span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>    delay(ms);
</span></span><span style=display:flex><span>    digitalWrite(<span style=color:#ae81ff>5</span>, <span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=ステッピングモーター>ステッピングモーター</h2><p><a href=https://jinnosukekato.github.io/monokon-wiki/hardware/about-parts/output-parts/stepper>ステッピングモーター</a>を回転させる関数です</p><p>二次元配列をパターンに使用した例</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++><span style=display:flex><span><span style=color:#66d9ef>void</span> <span style=color:#a6e22e>stepper</span>() {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>int</span> PTN[<span style=color:#ae81ff>4</span>][<span style=color:#ae81ff>4</span>] <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>    { <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span> },
</span></span><span style=display:flex><span>    { <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span> },
</span></span><span style=display:flex><span>    { <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span> },
</span></span><span style=display:flex><span>    { <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span> }
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> i <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; i <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>4</span>; i<span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> pin <span style=color:#f92672>=</span> <span style=color:#ae81ff>12</span>; pin <span style=color:#f92672>&lt;=</span> <span style=color:#ae81ff>15</span>; pin<span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>      digitalWrite(pin, PTN[i][pin <span style=color:#f92672>-</span> <span style=color:#ae81ff>12</span>]);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    clock();
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>ビットでパターンを作成した例 (暗記はしやすいかもしれない)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++><span style=display:flex><span><span style=color:#66d9ef>void</span> <span style=color:#a6e22e>stepper</span>() {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>int</span> PTN[<span style=color:#ae81ff>4</span>] <span style=color:#f92672>=</span> { <span style=color:#ae81ff>12</span>, <span style=color:#ae81ff>6</span>, <span style=color:#ae81ff>3</span>, <span style=color:#ae81ff>9</span> }; <span style=color:#75715e>// 二進数に変換すると意味が分かる
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> p : PTN) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> j <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; j <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>4</span>; j<span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>      digitalWrite(j <span style=color:#f92672>+</span> <span style=color:#ae81ff>6</span>, (p <span style=color:#f92672>&gt;&gt;</span> j) <span style=color:#f92672>&amp;</span> <span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    clock();
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=7セグメント>7セグメント</h2><p><a href=https://jinnosukekato.github.io/monokon-wiki/hardware/about-parts/output-parts/seven-segment>7セグメント</a>を光らせるためのいろいろな関数です</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++><span style=display:flex><span><span style=color:#75715e>// 点灯パターン
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#66d9ef>int</span> SEG_PTN[][<span style=color:#ae81ff>7</span>] <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>  { <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span> },  <span style=color:#75715e>// 0
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  { <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span> },  <span style=color:#75715e>// 1
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  { <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span> },  <span style=color:#75715e>// 2
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  { <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span> },  <span style=color:#75715e>// 3
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  { <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span> },  <span style=color:#75715e>// 4
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  { <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span> },  <span style=color:#75715e>// 5
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  { <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span> },  <span style=color:#75715e>// 6
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  { <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span> },  <span style=color:#75715e>// 7
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  { <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span> },  <span style=color:#75715e>// 8
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  { <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span> },  <span style=color:#75715e>// 9
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  { <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span> },  <span style=color:#75715e>// 空白(リセット用)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 信号だけ送る関数
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>void</span> <span style=color:#a6e22e>seg</span>(<span style=color:#66d9ef>int</span> num) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> i <span style=color:#f92672>=</span> <span style=color:#ae81ff>12</span>; i <span style=color:#f92672>&lt;=</span> <span style=color:#ae81ff>18</span>; i<span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>    digitalWrite(i, SEG_PTN[num][i <span style=color:#f92672>-</span> <span style=color:#ae81ff>12</span>]);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 左側だけ光らせる関数
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>void</span> <span style=color:#a6e22e>segL</span>(<span style=color:#66d9ef>int</span> num) {
</span></span><span style=display:flex><span>  seg(<span style=color:#ae81ff>10</span>);  <span style=color:#75715e>//残像防止
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  digitalWrite(<span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>  digitalWrite(<span style=color:#ae81ff>3</span>, <span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>  seg(num);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 右側だけ光らせる関数
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>void</span> <span style=color:#a6e22e>segR</span>(<span style=color:#66d9ef>int</span> num) {
</span></span><span style=display:flex><span>  seg(<span style=color:#ae81ff>10</span>);  <span style=color:#75715e>//残像防止
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  digitalWrite(<span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>  digitalWrite(<span style=color:#ae81ff>3</span>, <span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>  seg(num);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 両方を指定した時間光らせる関数
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>void</span> <span style=color:#a6e22e>segW</span>(<span style=color:#66d9ef>int</span> l, <span style=color:#66d9ef>int</span> r, <span style=color:#66d9ef>int</span> duration) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> i <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; i <span style=color:#f92672>&lt;=</span> duration; i<span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (i <span style=color:#f92672>%</span> <span style=color:#ae81ff>2</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>      segL(l);
</span></span><span style=display:flex><span>    } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>      segR(r);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    delay(<span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=ステッピングモーターと7セグメント>ステッピングモーターと7セグメント</h2><p>県大会レベルでは一番の難関だと思うので、あえてここにはコードを書きませんが、ヒントは</p><ul><li>ステッピングモータのクロックの前に余計な信号を入れないこと</li><li>ステッピングモータのクロックの間も7セグメントを点灯させること</li></ul><p>です</p><p>どうしてもコードが見たければ以下のリポジトリに書いてあるので見てください
<a href=https://github.com/jinnosukeKato/Monokon-Kanagawa-2022 target=_blank>https://github.com/jinnosukeKato/Monokon-Kanagawa-2022</a></p><h2 id=押して離されたらバンプ>押して離されたら(バンプ)</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#66d9ef>int</span> SW <span style=color:#f92672>=</span> <span style=color:#ae81ff>22</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>void</span> <span style=color:#a6e22e>loop</span>() {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>while</span>(digitalRead(SW) <span style=color:#f92672>==</span> <span style=color:#ae81ff>1</span>) {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ここに押されている間の待機動作
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>if</span>(digitalRead(SW) <span style=color:#f92672>!=</span> <span style=color:#ae81ff>1</span>) {
</span></span><span style=display:flex><span>      <span style=color:#75715e>// ここには離されたときに動作する内容
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><footer class=footline></footer></article></div></main></div><script src=https://jinnosukekato.github.io/monokon-wiki/js/clipboard.min.js?1684985525 defer></script>
<script src=https://jinnosukekato.github.io/monokon-wiki/js/perfect-scrollbar.min.js?1684985525 defer></script>
<script src=https://jinnosukekato.github.io/monokon-wiki/js/theme.js?1684985525 defer></script></body></html>